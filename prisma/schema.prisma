// =======================
// ‚öôÔ∏è Prisma Configuration
// =======================
generator client { 
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================
// üß± ENUMS
// =======================
enum StatusPinjaman {
  LUNAS
  BELUM_LUNAS
}

// =======================
// üë• Anggota & Jabatan
// =======================
model Jabatan {
  id          String     @id @default(uuid())
  nama        String

  // üî• Soft delete fields
  deleted_at  DateTime?
  deleted_by  String?

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  created_by  String?
  updated_by  String?

  anggota     Anggota[]

  @@map("jabatan")
}



model Anggota {
  id          String     @id @default(uuid())
  id_jabatan  String
  nama        String
  email       String     @unique
  password    String
  alamat      String?
  no_hp       String?

  deleted_at  DateTime?  // Soft delete untuk anggota

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  created_by  String?
  updated_by  String?

  jabatan     Jabatan     @relation(fields: [id_jabatan], references: [id], onDelete: Cascade)
  tabungan    Tabungan[]
  pinjaman    Pinjaman[]
  penarikan   Penarikan[]

  // relations for Kas (added)
  kasCreated   KasKoperasi[] @relation("KasCreatedBy")
  kasDeleted   KasKoperasi[] @relation("KasDeletedBy")

  @@map("anggota")
}


// =======================
// üí∞ Tabungan & Penarikan
// =======================
model KategoriSimpanan {
  id          String     @id @default(uuid())
  nama        String     @unique

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  created_by  String?
  updated_by  String?

  // üî• DITAMBAHKAN
  deleted_at  DateTime?
  deleted_by  String?

  tabungan    Tabungan[]

  @@map("kategori_simpanan")
}

model Tabungan {
  id                    String            @id @default(uuid())
  id_anggota            String
  id_kategori_simpanan  String
  tanggal               DateTime
  jumlah                Float

  created_at            DateTime          @default(now())
  updated_at            DateTime          @updatedAt
  created_by            String?
  updated_by            String?

  anggota               Anggota           @relation(fields: [id_anggota], references: [id], onDelete: Cascade)
  kategoriSimpanan      KategoriSimpanan  @relation(fields: [id_kategori_simpanan], references: [id], onDelete: Restrict)
  penarikan             Penarikan[]

  @@map("tabungan")
}

model Penarikan {
  id          String     @id @default(uuid())
  id_anggota  String
  id_tabungan String
  tanggal     DateTime
  jumlah      Float

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  created_by  String?
  updated_by  String?

  anggota     Anggota    @relation(fields: [id_anggota], references: [id], onDelete: Cascade)
  tabungan    Tabungan   @relation(fields: [id_tabungan], references: [id], onDelete: Cascade)

  @@map("penarikan")
}

// =======================
// üí∏ Pinjaman & Angsuran
// =======================
model KategoriJangkaWaktu {
  id          String     @id @default(uuid())
  nama        String     @unique

  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  created_by  String?
  updated_by  String?
  deleted_at DateTime?
  pinjaman    Pinjaman[]

  @@map("kategori_jangka_waktu")
}

model Pinjaman {
  id                    String              @id @default(uuid())
  id_anggota            String
  id_jangka_waktu       String
  tanggal               DateTime
  jumlah                Float
  status                StatusPinjaman      @default(BELUM_LUNAS)
  tanggal_jatuh_tempo   DateTime

  deleted_at            DateTime?           // Soft delete untuk pinjaman

  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
  created_by            String?
  updated_by            String?

  anggota               Anggota             @relation(fields: [id_anggota], references: [id], onDelete: Cascade)
  jangkaWaktu           KategoriJangkaWaktu @relation(fields: [id_jangka_waktu], references: [id], onDelete: Restrict)
  angsuran              Angsuran[]

  @@map("pinjaman")
}

model Angsuran {
  id                  String     @id @default(uuid())
  pinjaman_id         String
  tanggal_pembayaran  DateTime
  jumlah_pembayaran   Float
  sisa_pinjaman       Float

  created_at          DateTime   @default(now())
  updated_at          DateTime   @updatedAt
  created_by          String?
  updated_by          String?

  pinjaman            Pinjaman   @relation(fields: [pinjaman_id], references: [id], onDelete: Cascade)

  @@map("angsuran")
}

// =======================
// üè¶ Kas Koperasi
// =======================
model KasKoperasi {
  id          String    @id @default(uuid())
  nominal     Float
  tanggal     DateTime

  note        String?              // tambahan: keterangan / note

  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  // audit fields (ids)
  created_by  String?
  updated_by  String?
  deleted_at  DateTime?
  deleted_by  String?

  // relations to Anggota (optional convenience)
  createdBy   Anggota?  @relation("KasCreatedBy", fields: [created_by], references: [id], onDelete: SetNull)
  deletedBy   Anggota?  @relation("KasDeletedBy", fields: [deleted_by], references: [id], onDelete: SetNull)

  @@map("kas_koperasi")
}

